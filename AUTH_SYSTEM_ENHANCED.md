# üîê –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

–°–∏—Å—Ç–µ–º–∞ **—É–∂–µ —Ä–∞–±–æ—Ç–∞–ª–∞** –≤ `AppNavigator`, –Ω–æ —Ç–µ–ø–µ—Ä—å **—É–ª—É—á—à–µ–Ω–∞**:

```typescript
// –í AppNavigator.tsx
const userIsAuthenticated = isAuthenticated();

return (
  <AuthGuard>
    <NavigationContainer>
      {userIsAuthenticated ? (
        <MainTabs />           // ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      ) : (
        <AuthScreen />         // ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω
      )}
    </NavigationContainer>
  </AuthGuard>
);
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤**

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ `checkTokenExpiry()`
- ‚úÖ **–ê–≤—Ç–æ–ª–æ–≥–∞—É—Ç –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞**
- ‚úÖ **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç** –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è

```typescript
// –í userStore.ts
checkTokenExpiry: () => {
  const now = Date.now();
  const isExpired = now >= state.tokenExpiry;
  
  if (isExpired) {
    console.log('‚è∞ –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –≤—ã–ø–æ–ª–Ω—è–µ–º –∞–≤—Ç–æ–ª–æ–≥–∞—É—Ç');
    get().logout();
    return false;
  }
  
  return true;
}
```

### 3. **AuthGuard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- ‚úÖ **–ö—Ä–∞—Å–∏–≤—ã–π —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏** –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

```typescript
// –í AuthGuard.tsx
useEffect(() => {
  const interval = setInterval(() => {
    if (isAuthenticated()) {
      checkTokenExpiry(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    }
  }, 5 * 60 * 1000);
  
  return () => clearInterval(interval);
}, []);
```

### 4. **–ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ API –∑–∞–ø—Ä–æ—Å–æ–≤**

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
- ‚úÖ **–ê–≤—Ç–æ–ª–æ–≥–∞—É—Ç –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ** –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫**
- ‚úÖ **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ API**

```typescript
// –í useAuthInterceptor.ts
window.fetch = async (input, init) => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
  if (isAuthenticated() && !checkTokenExpiry()) {
    throw new Error('–¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫');
  }
  
  const response = await originalFetch(input, init);
  
  // –ê–≤—Ç–æ–ª–æ–≥–∞—É—Ç –ø—Ä–∏ 401
  if (response.status === 401) {
    logout();
    throw new Error('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞');
  }
  
  return response;
};
```

### 5. **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏**

- ‚úÖ **–ï–¥–∏–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `isLoading`** –≤ userStore
- ‚úÖ **–ü–æ–∫–∞–∑ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞** –≤–æ –≤—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π** –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Üí `AuthGuard` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω
2. **–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `MainTabs`
3. **–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω/–∏—Å—Ç–µ–∫** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `AuthScreen`
4. **–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ª–æ–≥–∏–Ω–µ** ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–æ–∫–µ–Ω
5. **–ü—Ä–∏ API –∑–∞–ø—Ä–æ—Å–∞—Ö** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
6. **–ü—Ä–∏ 401 –æ—à–∏–±–∫–µ** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç

### –°—Ö–µ–º–∞ –∑–∞—â–∏—Ç—ã:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí AuthGuard ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ ‚Üí 
‚îú‚îÄ ‚úÖ –í–∞–ª–∏–¥–µ–Ω ‚Üí MainTabs (–æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
‚îî‚îÄ ‚ùå –ù–µ–≤–∞–ª–∏–¥–µ–Ω ‚Üí AuthScreen (—ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞)

API –∑–∞–ø—Ä–æ—Å ‚Üí useAuthInterceptor ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ ‚Üí
‚îú‚îÄ ‚úÖ –í–∞–ª–∏–¥–µ–Ω ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
‚îú‚îÄ ‚ùå –ò—Å—Ç–µ–∫ ‚Üí –∞–≤—Ç–æ–ª–æ–≥–∞—É—Ç
‚îî‚îÄ 401 –æ—à–∏–±–∫–∞ ‚Üí –∞–≤—Ç–æ–ª–æ–≥–∞—É—Ç
```

## üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### ‚úÖ –ß—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:

1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**: —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ ‚Üí —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞
2. **–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ª–æ–≥–∏–Ω–µ**: –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **–ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω
4. **–ü—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö**: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
5. **–ü—Ä–∏ 401 –æ—à–∏–±–∫–µ**: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- **JWT —Ç–æ–∫–µ–Ω—ã** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout** –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏
- **–ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤**
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** –≤ Zustand persist

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ userStore:

```typescript
// –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ—Ä–µ—Ç—Å—è –∏–∑ JWT)
setToken(token, 24); // 24 —á–∞—Å–∞

// –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤ AuthGuard)
const interval = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
const fiveMinutes = 5 * 60 * 1000; // –ó–∞ 5 –º–∏–Ω—É—Ç
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Üí –≤–∏–¥–∏—Ç AuthScreen
2. **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Üí –≤–∏–¥–∏—Ç MainTabs
3. **–ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
4. **401 –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞** ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π logout
5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

### Debug –ª–æ–≥–∏:

```bash
üîê AuthGuard: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚è∞ –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç: 2024-06-18T15:30:00.000Z
üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: { hasValidToken: true, hasUser: true, tokenNotExpired: true, result: true }
üîê useAuthInterceptor: –ü–æ–ª—É—á–µ–Ω–∞ 401 –æ—à–∏–±–∫–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º logout
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:

- **100% –∑–∞—â–∏—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã** —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∑–¥–µ
- **–ù–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–û—Ç–ª–∏—á–Ω—ã–π UX** –±–µ–∑ "–º–∏–≥–∞—é—â–∏—Ö" —ç–∫—Ä–∞–Ω–æ–≤
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API** –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:

- –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ edge cases
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Graceful error handling

**–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –í–°–ï–ì–î–ê —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞! üéâ** 