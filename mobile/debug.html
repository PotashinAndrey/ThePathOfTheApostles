<!DOCTYPE html>
<html>
<head>
    <title>🔧 Debug LocalStorage</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>🔧 Debug LocalStorage для "Путь Апостолов"</h1>
    
    <div id="results"></div>
    
    <button onclick="testStorage()">🧪 Тест Storage</button>
    <button onclick="clearStorage()">🗑️ Очистить</button>
    <button onclick="checkExisting()">👀 Проверить существующие</button>
    
    <script>
        const log = (message, type = 'info') => {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
            console.log(message);
        };

        const testStorage = () => {
            document.getElementById('results').innerHTML = '';
            
            try {
                log('🚀 Начинаем тест localStorage...');
                
                // Тест 1: Базовая работа localStorage
                localStorage.setItem('test-key', 'test-value');
                const testValue = localStorage.getItem('test-key');
                if (testValue === 'test-value') {
                    log('✅ Базовый localStorage работает', 'success');
                } else {
                    log('❌ Базовый localStorage НЕ работает', 'error');
                }
                
                // Тест 2: JSON данные (как в zustand)
                const testUser = {
                    id: 'test-user-123',
                    name: 'Тестовый пользователь',
                    timestamp: Date.now()
                };
                
                const userJson = JSON.stringify(testUser);
                localStorage.setItem('test-user', userJson);
                const storedUserJson = localStorage.getItem('test-user');
                const parsedUser = JSON.parse(storedUserJson);
                
                if (parsedUser.id === testUser.id) {
                    log('✅ JSON storage работает', 'success');
                } else {
                    log('❌ JSON storage НЕ работает', 'error');
                }
                
                // Тест 3: Симуляция zustand persist
                const zustandData = {
                    state: {
                        user: {
                            id: 'dev-user-' + Date.now(),
                            email: 'dev@apostles.app',
                            name: 'Разработчик'
                        }
                    },
                    version: 0
                };
                
                localStorage.setItem('user-storage', JSON.stringify(zustandData));
                const storedZustand = localStorage.getItem('user-storage');
                const parsedZustand = JSON.parse(storedZustand);
                
                if (parsedZustand.state.user.id.startsWith('dev-user-')) {
                    log('✅ Zustand persist симуляция работает', 'success');
                } else {
                    log('❌ Zustand persist симуляция НЕ работает', 'error');
                }
                
                log('🎉 Все тесты завершены!');
                
            } catch (error) {
                log('🚨 Критическая ошибка: ' + error.message, 'error');
            }
        };

        const clearStorage = () => {
            localStorage.clear();
            log('🗑️ LocalStorage очищен', 'success');
        };

        const checkExisting = () => {
            document.getElementById('results').innerHTML = '';
            log('👀 Проверяем существующие данные...');
            
            // Проверяем ключ от zustand
            const userStorage = localStorage.getItem('user-storage');
            if (userStorage) {
                log('📦 Найден user-storage: ' + userStorage, 'success');
                try {
                    const parsed = JSON.parse(userStorage);
                    log('👤 Пользователь: ' + JSON.stringify(parsed.state?.user || 'не найден'), 'info');
                } catch (e) {
                    log('❌ Ошибка парсинга user-storage: ' + e.message, 'error');
                }
            } else {
                log('📦 user-storage пуст или не найден', 'info');
            }
            
            // Показываем все ключи
            const keys = Object.keys(localStorage);
            log('🔑 Все ключи в localStorage: ' + keys.join(', '), 'info');
        };

        // Автоматический тест при загрузке
        window.onload = () => {
            log('🌐 Browser: ' + navigator.userAgent);
            checkExisting();
        };
    </script>
</body>
</html> 