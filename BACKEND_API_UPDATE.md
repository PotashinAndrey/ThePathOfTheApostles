# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Backend API –¥–ª—è –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã –ë–î

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î (`backend/prisma/schema.prisma`)

**–ù–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:**
- `Path` - –ø—É—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è
- `Challenge` - –∑–∞–¥–∞–Ω–∏—è –æ—Ç –∞–ø–æ—Å—Ç–æ–ª–æ–≤  
- `Skill` - –Ω–∞–≤—ã–∫–∏/–¥–æ–±—Ä–æ–¥–µ—Ç–µ–ª–∏ –∞–ø–æ—Å—Ç–æ–ª–æ–≤
- `Chat` - —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–ø–æ—Å—Ç–æ–ª–∞–º–∏
- `Subscription` - –ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏
- `Achievement` - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `Feature` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∏—á–∞—Ç–æ–≥–ª–∏–Ω–≥–∞
- `PhraseSet` - –Ω–∞–±–æ—Ä—ã —Ñ—Ä–∞–∑ –¥–ª—è –∞–ø–æ—Å—Ç–æ–ª–æ–≤
- `ChatPreset` - –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–æ–≤
- `ChallengeResult` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
- `UserProgress` - –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `UserApostleRelation` - –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –∞–ø–æ—Å—Ç–æ–ª–∞–º–∏
- `Phrase` - —Ü–∏—Ç–∞—Ç—ã –∏ —Ñ—Ä–∞–∑—ã –∞–ø–æ—Å—Ç–æ–ª–æ–≤
- `UserNote` - –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `CompletedChallengesList` - —Å–ø–∏—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- `UserPathsList` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—É—Ç–∏  
- `UserAchievementsList` - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:**
- `User` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è avatar, status, currentSubscription, —Å–≤—è–∑—å —Å UserProgress
- `Apostle` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è title, virtueId, phraseSetsId, –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å–≤—è–∑–∏
- `ChatMessage` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è voiceUrl, metadata, apostleId, relatedChallengeId

### 2. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Ç–∏–ø–æ–≤ (`backend/src/types/api.ts`)

–û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è:
- API responses (UserResponse, ApostleResponse, ChatInfo, etc.)
- Request types (LoginRequest, RegisterRequest, etc.)
- API wrapper (ApiResponse<T>)

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`backend/src/lib/auth.ts`)

- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email –∏ –ø–∞—Ä–æ–ª—è
- –£—Ç–∏–ª–∏—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
- Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. –°–æ–∑–¥–∞–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –Ω–æ–≤—ã—Ö endpoints

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤—ã—Ö API endpoints:
```
/api/user/profile     - GET, PUT (–ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
/api/user/stats       - GET (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
/api/chats           - GET, POST (—Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤)
/api/chats/[id]      - GET (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
```

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Prisma Client

–ü—Ä–æ–±–ª–µ–º–∞: –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã Prisma client –Ω–µ –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏ –º–æ–¥–µ–ª–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd backend
rm -rf node_modules/.prisma
rm -rf node_modules/@prisma
npm install
npx prisma generate
npx prisma migrate reset --force
```

### 2. –ó–∞–≤–µ—Ä—à–∏—Ç—å API endpoints

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ endpoints –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

#### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ `POST /api/auth/login` - –ª–æ–≥–∏–Ω
- ‚úÖ `POST /api/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚ùå `POST /api/auth/logout` - –≤—ã—Ö–æ–¥
- ‚ùå `POST /api/auth/forgot-password` - –∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å
- ‚ùå `POST /api/auth/reset-password` - —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚ùå `GET /api/user/profile` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- ‚ùå `PUT /api/user/profile` - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- ‚ùå `POST /api/user/change-password` - —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
- ‚ùå `GET /api/user/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ê–ø–æ—Å—Ç–æ–ª—ã
- ‚úÖ `GET /api/apostles` - —Å–ø–∏—Å–æ–∫ –∞–ø–æ—Å—Ç–æ–ª–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚ùå `GET /api/apostles/[id]` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–ø–æ—Å—Ç–æ–ª

#### –ß–∞—Ç—ã
- ‚ùå `GET /api/chats` - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå `POST /api/chats` - —Å–æ–∑–¥–∞—Ç—å —á–∞—Ç
- ‚ùå `GET /api/chats/[id]` - –ø–æ–ª—É—á–∏—Ç—å —á–∞—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚ùå `POST /api/chats/[id]/messages` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

#### –ü—É—Ç–∏ –∏ –∑–∞–¥–∞–Ω–∏—è
- ‚ùå `GET /api/paths` - —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π
- ‚ùå `GET /api/paths/[id]` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—É—Ç—å
- ‚ùå `GET /api/challenges` - –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå `GET /api/challenges/[id]` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- ‚ùå `POST /api/challenges/[id]/complete` - –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ

#### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- ‚ùå `GET /api/achievements` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- ‚ùå `GET /api/user/achievements` - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü–æ–¥–ø–∏—Å–∫–∏
- ‚ùå `GET /api/subscriptions` - –ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏
- ‚ùå `POST /api/user/subscription` - –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

#### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  
- ‚ùå `GET /api/notifications` - —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ùå `PUT /api/notifications/[id]/read` - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Ä–∞–Ω–æ–≤ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã:**

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
   - –õ–æ–≥–∏–Ω (email, password)
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (name, email, password, confirmPassword)
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

2. **–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω**
   - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
   - –°—Ç—Ä–∏–∫ –¥–Ω–µ–π –∏ –æ–±—â–∏–µ –¥–Ω–∏
   - –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ–∫—É—â–µ–≥–æ –ø—É—Ç–∏
   - –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞–Ω–∏—è (–¥–æ 3)
   - –ö–Ω–æ–ø–∫–∞ "–ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –∞–ø–æ—Å—Ç–æ–ª–æ–º"

3. **–ù–∞–≤–∏–≥–∞—Ü–∏—è (5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)**
   - –ì–ª–∞–≤–Ω–∞—è
   - –ü—É—Ç—å  
   - –ë–µ—Å–µ–¥—ã
   - –ó–∞–¥–∞–Ω–∏—è
   - –ü—Ä–æ—Ñ–∏–ª—å (–¥—Ä–æ–ø–¥–∞—É–Ω: –ø—Ä–æ—Ñ–∏–ª—å, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

4. **–ü—Ä–æ—Ñ–∏–ª—å**
   - –ê–≤–∞—Ç–∞—Ä, –∏–º—è, –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –°—Ç—Ä–∏–∫ –¥–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π/–ø—É—Ç–µ–π
   - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

5. **–û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ü–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏  
   - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
   - –ó–∞–¥–∞–Ω–∏—è
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–¥–∞–Ω–∏—è
   - –ë–µ—Å–µ–¥—ã (—Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤)
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –±–µ—Å–µ–¥–∞
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Ç–∏
   - –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —á–∞—Ç

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞ iPhone/Android
- –§–∏—á–∞—Ç–æ–≥–ª–∏–Ω–≥

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
GET /api/user/stats
Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "streak": 7,
    "totalDays": 14,
    "challengesCompleted": 5,
    "pathsCompleted": 1,
    "currentPath": {...},
    "activeChallenges": [...]
  }
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
```
POST /api/chats
Authorization: Bearer <token>
Content-Type: application/json

{
  "apostleId": "peter",
  "pathId": "discipline-path", // optional
  "challengeId": "daily-discipline" // optional
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```
POST /api/chats/[chatId]/messages
Authorization: Bearer <token>
Content-Type: application/json

{
  "content": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
  "voiceUrl": "https://..." // optional
}
``` 